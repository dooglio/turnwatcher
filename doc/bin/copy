#!/bin/sh

# Copy only what changed

DRY=false
DESTINATION=

while test ! -z "$1"
do
	case "$1" in
	-h|--help)
		echo "Usage: $0 [-opts] <destination directory>";
		echo "Where -opts can be:"
		echo "  -d or --dry      dry run, show what will be copied"
		echo "  -h or --help     print out this help screen"
		exit 1;;
	-d|--dry)
		DRY=true;
		shift;;

	*)	if test ! -z "$DESTINATION";
		then
			echo "ERROR: only one destination accepted";
			exit 1;
		fi
		DESTINATION=$1/doc;
		shift;;
	esac
done

if test -z "$DESTINATION"
then
	echo "ERROR: no destination specified?! (try --help)"
	exit 1;
fi


if test ! -d $DESTINATION
then
	echo "ERROR: invalid destination, it must point to the top folder of some Turn Watcher directory (try --help)"
	exit 1;
fi

err=0
for f in {en,es,fr}/*.html
do
	COPY=false
	if test ! -f $DESTINATION/$f
	then
		if test -d $DESTINATION/$f
		then
			echo "ERROR: $DESTINATION/$f is a directory!"
			err=1
		else
			COPY=true
		fi
	elif ! cmp -s $DESTINATION/$f $f
	then
		# Copy only if it changed
		COPY=true
	fi
	if $COPY
	then
		if $DRY
		then
			echo cp $f $DESTINATION/$f
		else
			cp $f $DESTINATION/$f
		fi
	fi
done

exit $err
