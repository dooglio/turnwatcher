#
# File:		$Source: dev/linux/turnwatcher-rpm.spec.in $
# Object:	Specification file to build an RPM package
# Version:	$Revision: 1.2 $
# Last Edit:	$Date: 2009/03/17 22:45:31 $
#
# Copyright:	Copyright (c) 2006-2009 Made to Order Software, Corp.
#
#		All Rights Reserved.
#
#		This software and its associated documentation contains
#		proprietary, confidential and trade secret information
#		of Made to Order Software, Corp. and except as provided by
#		written agreement with Made to Order Software, Corp.
#
#		a) no part may be disclosed, distributed, reproduced,
#		   transmitted, transcribed, stored in a retrieval system,
#		   adapted or translated in any form or by any means
#		   electronic, mechanical, magnetic, optical, chemical,
#		   manual or otherwise,
#
#		and
#
#		b) the recipient is not entitled to discover through reverse
#		   engineering or reverse compiling or other such techniques
#		   or processes the trade secrets contained therein or in the
#		   documentation.
#
#

## Replace the # by a % (and vice versa) to get full debug
#trace

%define prefix	/usr

Summary: Turn Watcher (tm) RPG GM Initiative Tracker
Name: turnwatcher
Icon: turnwatcher.xpm
Version: @VERSION@
Release: @BUILD_VERSION_STRING@
License: Copyright (c) Made to Order Software Corporation -- All rights reserved
Group: Amusements/Games
Vendor: Made to Order Software Corporation
# We don't need to specify where the source is
#Source: ...
BuildRoot: %{_builddir}/REDHAT/BUILD
URL: http://www.turnwatcher.com
Packager: Alexis Wilke <alexis@m2osw.com>

# Libraries (which we do not include in our sandbox) -> FC package
#
# Turn Watcher
# libc.so.6, libdl.so.2, libm.so.6 -> glibc-2.4-11
# libgcc_s.so.1 -> libgcc-4.1.1-1.fc5
# fontconfig1 -> fontconfig-2.3.94-2.fc5
# libstdc++.so.6 -> libstdc++-4.1.1-1.fc5
#
# libmo.so
# libltdl.so.3 -> libtool-libs
#
Requires: glibc, libgcc, fontconfig, libstdc++, libtool-libs

Provides: turnwatcher
Distribution: Turn Watcher RPM
# This would require us to have a RedHat database on our Debian boxes! Yack!
#BuildRequires: debhelper >= 4.0.0 base-files >= 3.1.0 binutils >= 2.15-5 coreutils >= 5.2.1 gcc >= 3.3.5-1  libc6 >= 2.3.2  libfontconfig1 >= 2.3.2 libgcc1 >= 1 libjpeg62 >= 6b-9 libmo >= 1.0.0-2 libpng12-0 >= 1.2.8rel-1 libstdc++5 >= 3.2 libtiff4 >= 3.6.1-3 libx11-6 >= 1 libxcursor1 >= 1.1.3 libxext6 >= 1 libxi6 >= 1 libxrandr2 >= 1 libxrender1 >= 0.9.0 zlib1g >= 1 libgtkmm-2.4-dev >= 2.8.0-0 libglibmm-2.4-dev >= 2.8.0-0
AutoReqProv: no

%description
Turn Watcher (tm) is a friend to RPG Game Masters. It helps the GM track
initiative rounds during combat, keeping track of the current turn. It also
tracks current hit points, keeps track of characters and monsters who delay or
ready an action and shows the current round number. Turn Watcher is not a free
application; a license from Made to Order Software Corporation must be
purchased in order to use this software.

%prep
# Make sure all the output dirs exist
mkdir -p REDHAT/{BUILD,RPMS} tmp

%build
# The build step is required in a spec; if not provided then it
# uses a default build step which is to run configure + make
# Since everything was already built with the debian/rules file
# we do not want to rebuild anything!
echo "Package already built by debian/rules."

%install
# We are in the directory with the usr directory from the debian
# build; we need it under the REDHAT/BUILD directory instead
mv ./usr ./REDHAT/BUILD/.


%clean
# Put the resulting RPM in a sensible place
# Now it can be i385 or amd64 so we use * because I do not know
# the exact variable name for the architecture (%{_build_arch}?)
mv ./REDHAT/RPMS/*/turnwatcher-%{version}-%{release}.*.rpm .
# We copied the usr directory, we can now remove it
rm -rf ./REDHAT ./tmp

%files
%defattr(-, root, root)
## rpmbuild will put this in turnwatcher-<version>, and maybe we should do the same?
##%doc ./usr/share/doc/turnwatcher/copyright

# We just want everything as is; it's already where it needs to be
/usr/*

%post

INSTDIR=@MO_PKGLIBDIR@
export LD_LIBRARY_PATH=${INSTDIR}/lib

GTKBINDIR=${INSTDIR}/bin
ETCDIR=${INSTDIR}/etc
ETCGTKDIR=${ETCDIR}/gtk-2.0
ETCPANGODIR=${ETCDIR}/pango
GTKLIBDIR=${INSTDIR}/lib
GTKDATADIR=${GTKLIBDIR}/gtk-2.0/@GTK_VERSION@
GTKIMMODULESDIR=${GTKDATADIR}/immodules
GTKLOADERSDIR=${GTKDATADIR}/loaders
GTKPANGODIR=${GTKLIBDIR}/pango/@PANGO_VERSION@/modules/
CONFMOD=/usr/share/debconf/confmodule

if test -x $CONFMOD -a -f $CONFMOD
then
	. $CONFMOD
fi

mkdir -p ${ETCGTKDIR} ${ETCPANGODIR}
${GTKBINDIR}/gtk-query-immodules-2.0	${GTKIMMODULESDIR}/*.so	> ${ETCGTKDIR}/gtk.immodules
${GTKBINDIR}/gdk-pixbuf-query-loaders	${GTKLOADERSDIR}/*.so	> ${ETCGTKDIR}/gdk-pixbuf.loaders
${GTKBINDIR}/pango-querymodules		${GTKPANGODIR}/*.so	> ${ETCPANGODIR}/pango.modules
if test -x /usr/bin/update-menus
then
	/usr/bin/update-menus
fi
ldconfig


%preun

RM=/bin/rm
INSTDIR=@MO_PKGLIBDIR@
ETCDIR=${INSTDIR}/etc

${RM} -rf ${ETCDIR}


%postun

if test -x /usr/bin/update-menus
then
	/usr/bin/update-menus
fi
ldconfig


%changelog
* Tue Mar 17 2009 Alexis Wilke <alexis@m2osw.com> 1.2
- Updated so it works for any architecture

* Sat Sep 09 2006 Alexis Wilke <alexis@m2osw.com> 1.1
- Initial RMP
- This is only the change log of the RPM spec file
  for the software changelog, look into /usr/share/turnwatcher


# vim: ts=8 sw=8
